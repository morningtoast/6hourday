{"ts":1345040679806,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?\n\tinclude(\"JSON.php\");\n\tinclude(\"cfw.inc.php\");\n\t\n\t$json = new Services_JSON();\n\t\n\tdefine(TODAY, date(\"Y-m-d\"));\n\t\n\t\nclass sixhours {\n\tfunction sixhours() {\n\t\tmysql_connect(\"localhost\",\"root\",\"admin\");\n\t\t\t\n\t\t\t$this->table = array(\n\t\t\t\t\"Users\"       => \"sixhourday.users\",\n\t\t\t\t\"Projects\"    => \"sixhourday.projects\",\n\t\t\t\t\"Tasks\"     => \"sixhourday.tasks\",\n\t\t\t\t\"Entries\"   => \"sixhourday.entries\"\n\t\t\t);\t\t\n\t}\n\t\n\tfunction createNewProject($a_data) {\n\t\t$a_data[\"ProjectID\"] = mysql_insert($a_data, $this->table[\"Projects\"]);\n\t\treturn($a_data);\n\t}\n\t\n\tfunction getProjectsByUser($id_user) {\n\t\t$a_list = mysql_query_list(\"select * from \".$this->table[\"Projects\"].\" where (UserID=\".$id_user.\") order by Name\");\t\t\t\n\t\treturn($a_list);\n\t}\n\t\n\tfunction createNewTask($a_data) {\n\t\t$a_data[\"TaskID\"] = mysql_insert($a_data, $this->table[\"Tasks\"]);\n\t\treturn($a_data);\n\t}\n\t\n\tfunction getTasksByProject($id_project) {\n\t\t$a_list = mysql_query_list(\"select * from \".$this->table[\"Tasks\"].\" where (ProjectID=\".$id_project.\") order by Name\");\t\t\t\n\t\treturn($a_list);\n\t}\n\t\n\tfunction getUserById($id_user) {\n\t\t$sql      = mysql_query(\"select * from \".$this->table[\"Users\"].\" where (UserID=\".$id_user.\")\");\n\t\t$a_record = mysql_fetch_assoc($sql);\t\n\t\t\n\t\treturn($a_record);\n\t}\n\t\n\tfunction hourMath($length, $hours) {\n\t\treturn($length * $hours);\n\t}\n\t\n\tfunction saveEntry($a_data) {\n\t\t$a_user = $this->getUserById(1);\n\t\t\n\t\t$a_data = array(\n\t\t\t\"UserID\"    => $a_user[\"UserID\"],\n\t\t\t\"TaskID\"    => $a_data[\"task\"][\"TaskID\"],\n\t\t\t\"ProjectID\" => $a_data[\"project\"][\"ProjectID\"],\n\t\t\t\"Length\"    => $a_data[\"time\"][\"Length\"],\n\t\t\t\"Hours\"     => $this->hourMath($a_data[\"time\"][\"Length\"], $a_user[\"Hours\"]),\n\t\t\t\"EntryDate\" => $a_data[\"log\"][\"Date\"],\n\t\t\t\"Date\"      => TODAY,\n\t\t\t\"Summary\"   => strip_tags($a_data[\"log\"][\"Summary\"])\n\t\t);\n\t\t\n\t\t//print_r($a_data);\n\t\t\n\t\t$id = mysql_insert($a_data, $this->table[\"Entries\"]);\n\t}\n}\t\n\t\n\t\n$six = new sixhours;\t\n\t\n\tif ($_POST[\"save\"]) {\n\t\t$six->saveEntry($_POST[\"save\"][\"data\"]);\n\t}\n\t\n\tswitch($_GET[\"lookup\"]) {\n\t\tdefault:break;\n\t\t\n\t\tcase \"newproject\":\n\t\t\t$a_list = array(\n\t\t\t\t\"UserID\"    => 1,\n\t\t\t\t\"Name\"      => $_GET[\"Name\"],\n\t\t\t);\n\t\t\t\n\t\t\t$a_list = $six->createNewProject($a_list);\n\t\t\t$output = $json->encode($a_list);\n\t\t\t\n\t\t\tbreak;\n\t\t\t\n\t\tcase \"newtask\":\n\t\t\t$a_list = array(\n\t\t\t\t\"ProjectID\" => $_GET[\"ProjectID\"],\n\t\t\t\t\"Name\"      => $_GET[\"Name\"],\n\t\t\t);\n\t\t\t\n\t\t\t$a_list = $six->createNewTask($a_list);\n\t\t\t$output = $json->encode($a_list);\n\t\t\n\t\t\tbreak;\n\t\t\n\t\tcase \"projects\":\n\t\t\t$a_list = $six->getProjectsByUser(1);\n\t\t\t$output = $json->encode($a_list);\n\t\t\t\n\t\t\tbreak;\t\t\n\t\t\n\t\tcase \"tasks\":\n\t\t\t$a_list = $six->getTasksByProject($_GET[\"ProjectID\"]);\n\t\t\t\n\t\t\t$output = $json->encode($a_list);\n\t\t\t\n\t\t\tbreak;\n\t\n\t}\n\t\necho $output;\t\n?>"]],"start1":0,"start2":0,"length1":0,"length2":2725}]],"length":2725}
